var kt=Object.defineProperty;var wt=(o,t,s)=>t in o?kt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var i=(o,t,s)=>(wt(o,typeof t!="symbol"?t+"":t,s),s);import{P as bt,W as Mt,S as J,F as at,C as ot,a as Z,A as xt,T as Ct,N as k,M as m,R as P,B as z,b as G,I as S,c as nt,d as E,e as L,V as y,f as It,g as V,h as Pt,E as Lt,i as zt,j as St,k as Q}from"./vendor.b16e062d.js";const Et=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}};Et();class Ft{constructor(){i(this,"camera");i(this,"scene");i(this,"renderer");i(this,"initCamera",()=>{this.camera.fov=50,this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.near=.01,this.camera.far=500,this.camera.updateProjectionMatrix(),this.camera.position.set(8,50,8),this.camera.lookAt(100,30,100),window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()})});i(this,"initScene",()=>{this.scene=new J;const t=8900331;this.scene.fog=new at(t,1,96),this.scene.background=new ot(t);const s=new Z(16777215,.5);s.position.set(500,500,500),this.scene.add(s);const e=new Z(16777215,.2);e.position.set(-500,500,-500),this.scene.add(e);const a=new xt(4210752);this.scene.add(a)});i(this,"initRenderer",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight)})});this.camera=new bt,this.renderer=new Mt,this.scene=new J,this.initScene(),this.initRenderer(),this.initCamera()}}var p=(o=>(o.walking="walking",o.sprinting="sprinting",o.flying="flying",o.sprintFlying="sprintFlying",o.sneaking="sneaking",o))(p||{}),O=(o=>(o[o.walking=5.612]="walking",o[o.sprinting=5.612]="sprinting",o[o.flying=21.78]="flying",o[o.sprintFlying=21.78]="sprintFlying",o[o.sneaking=2.55]="sneaking",o))(O||{});class Ht{constructor(){i(this,"mode","walking");i(this,"speed",O[this.mode]);i(this,"falling",38.4);i(this,"jump",1.2522);i(this,"body",{height:1.8,width:.5})}setMode(t){this.mode=t,this.speed=O[this.mode]}}var jt="/assets/stone.fa5e82cb.png",At="/assets/coal_ore.29c9a29e.png",Bt="/assets/iron_ore.78230e9e.png",qt="/assets/grass_block_side.1f5d4845.png",Rt="/assets/grass_top_green.be9cf310.png",_t="/assets/dirt.fb045025.png",Gt="/assets/oak_log.fc1a2462.png",Ot="/assets/oak_log_top.6a68c340.png",Kt="/assets/oak_leaves.776aee85.png",Xt="/assets/sand.f4bf1751.png",$t="/assets/oak_planks.be4a7f91.png",Dt="/assets/diamond_block.fb45cc99.png",Tt="/assets/quartz_block_side.0e4d401c.png",Yt="/assets/glass.17e849a2.png",Nt="/assets/bedrock.3e3a8330.png",b=(o=>(o.grass="grass",o.dirt="dirt",o.tree="tree",o.leaf="leaf",o.sand="sand",o.stone="stone",o.coal="coal",o.wood="wood",o.diamond="diamond",o.quartz="quartz",o.glass="glass",o.bedrock="bedrock",o))(b||{});let w=new Ct;const rt=w.load(Rt),B=w.load(qt),q=w.load(Gt),K=w.load(Ot),X=w.load(_t),lt=w.load(jt),ht=w.load(At),Ut=w.load(Bt),ct=w.load(Kt),dt=w.load(Xt),ut=w.load($t),mt=w.load(Dt),ft=w.load(Tt),gt=w.load(Yt),yt=w.load(Nt);rt.magFilter=k;B.magFilter=k;q.magFilter=k;K.magFilter=k;X.magFilter=k;lt.magFilter=k;ht.magFilter=k;Ut.magFilter=k;ct.magFilter=k;dt.magFilter=k;ut.magFilter=k;mt.magFilter=k;ft.magFilter=k;gt.magFilter=k;yt.magFilter=k;class Wt{constructor(){i(this,"materials",{grass:[new m({map:B}),new m({map:B}),new m({map:rt}),new m({map:X}),new m({map:B}),new m({map:B})],dirt:new m({map:X}),sand:new m({map:dt}),tree:[new m({map:q}),new m({map:q}),new m({map:K}),new m({map:K}),new m({map:q}),new m({map:q})],leaf:new m({map:ct,color:new ot(0,1,0),transparent:!0}),stone:new m({map:lt}),coal:new m({map:ht}),wood:new m({map:ut}),diamond:new m({map:mt}),quartz:new m({map:ft}),glass:new m({map:gt,transparent:!0}),bedrock:new m({map:yt})});i(this,"get",t=>this.materials[t])}}class ${constructor(t,s,e,a,n){i(this,"object");i(this,"x");i(this,"y");i(this,"z");i(this,"type");i(this,"placed");i(this,"attributes",[]);this.x=t,this.y=s,this.z=e,this.type=a,this.placed=n}}class Jt{constructor(t,s,e){i(this,"scene");i(this,"camera");i(this,"terrain");i(this,"raycaster");i(this,"block",null);i(this,"geometry",new z(1.01,1.01,1.01));i(this,"material",new m({transparent:!0,opacity:.25}));i(this,"mesh",new G(new z,this.material));i(this,"index",0);i(this,"instanceMesh",new S(new z,new nt,1e3));this.camera=s,this.scene=t,this.terrain=e,this.raycaster=new P,this.raycaster.far=8}update(){this.scene.remove(this.mesh),this.index=0,this.instanceMesh.instanceMatrix=new E(new Float32Array(1e3*16),16);const t=this.camera.position,s=new L,e=new Map,a=this.terrain.noise;let n=Math.round(t.x),l=Math.round(t.z);for(let h=-8;h<8;h++)for(let c=-8;c<8;c++){let f=n+h,u=l+c,v=Math.floor(a.get(f/a.gap,u/a.gap,a.seed)*a.amp)+30;e.set(`${f}_${v}_${u}`,this.index),s.setPosition(f,v,u),this.instanceMesh.setMatrixAt(this.index++,s);let x=a.get(f/a.stoneGap,u/a.stoneGap,a.stoneSeed)*a.stoneAmp;if(a.get(f/a.treeGap,u/a.treeGap,a.treeSeed)*a.treeAmp>a.treeThreshold&&v-30>=-3&&x<a.stoneThreshold)for(let d=1;d<=a.treeHeight;d++)e.set(`${f}_${v+d}_${u}`,this.index),s.setPosition(f,v+d,u),this.instanceMesh.setMatrixAt(this.index++,s)}for(const h of this.terrain.customBlocks)if(h.placed)s.setPosition(h.x,h.y,h.z),this.instanceMesh.setMatrixAt(this.index++,s);else if(e.has(`${h.x}_${h.y}_${h.z}`)){let c=e.get(`${h.x}_${h.y}_${h.z}`);this.instanceMesh.setMatrixAt(c,new L().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))}if(this.raycaster.setFromCamera({x:0,y:0},this.camera),this.block=this.raycaster.intersectObject(this.instanceMesh)[0],this.block&&this.block.object instanceof S&&typeof this.block.instanceId=="number"){this.mesh=new G(this.geometry,this.material);let h=new L;this.block.object.getMatrixAt(this.block.instanceId,h);const c=new y().setFromMatrixPosition(h);this.mesh.position.set(c.x,c.y,c.z),this.scene.add(this.mesh)}}}class Zt{constructor(){i(this,"noise",new It);i(this,"seed",Math.random());i(this,"gap",22);i(this,"amp",8);i(this,"stoneSeed",this.seed*.4);i(this,"stoneGap",12);i(this,"stoneAmp",8);i(this,"stoneThreshold",3.5);i(this,"coalSeed",this.seed*.5);i(this,"coalGap",3);i(this,"coalAmp",8);i(this,"coalThreshold",3);i(this,"treeSeed",this.seed*.7);i(this,"treeGap",2);i(this,"treeAmp",6);i(this,"treeHeight",10);i(this,"treeThreshold",4);i(this,"leafSeed",this.seed*.8);i(this,"leafGap",2);i(this,"leafAmp",5);i(this,"leafThreshold",-.03);i(this,"get",(t,s,e)=>this.noise.noise(t,s,e))}}function Vt(){return new Worker("/assets/generate.707bb76c.js",{type:"module"})}var g=(o=>(o[o.grass=0]="grass",o[o.sand=1]="sand",o[o.tree=2]="tree",o[o.leaf=3]="leaf",o[o.dirt=4]="dirt",o[o.stone=5]="stone",o[o.coal=6]="coal",o[o.wood=7]="wood",o[o.diamond=8]="diamond",o[o.quartz=9]="quartz",o[o.glass=10]="glass",o[o.bedrock=11]="bedrock",o))(g||{});class Qt{constructor(t,s){i(this,"scene");i(this,"camera");i(this,"distance",3);i(this,"chunkSize",24);i(this,"maxCount");i(this,"chunk",new V(0,0));i(this,"previousChunk",new V(0,0));i(this,"noise",new Zt);i(this,"materials",new Wt);i(this,"materialType",[b.grass,b.sand,b.tree,b.leaf,b.dirt,b.stone,b.coal,b.wood,b.diamond,b.quartz,b.glass,b.bedrock]);i(this,"blocks",[]);i(this,"blocksCount",[]);i(this,"blocksFactor",[1,.2,.1,.7,.1,.2,.1,.1,.1,.1,.1,.1]);i(this,"customBlocks",[]);i(this,"highlight");i(this,"idMap",new Map);i(this,"generateWorker",new Vt);i(this,"cloud",new S(new z(20,5,14),new m({transparent:!0,color:16777215,opacity:.4}),1e3));i(this,"cloudCount",0);i(this,"cloudGap",5);i(this,"getCount",t=>this.blocksCount[t]);i(this,"setCount",t=>{this.blocksCount[t]=this.blocksCount[t]+1});i(this,"initBlocks",()=>{for(const s of this.blocks)this.scene.remove(s);this.blocks=[];const t=new z;for(let s=0;s<this.materialType.length;s++){let e=new S(t,this.materials.get(this.materialType[s]),this.maxCount*this.blocksFactor[s]);e.name=g[s],this.blocks.push(e),this.scene.add(e)}this.blocksCount=new Array(this.materialType.length).fill(0)});i(this,"resetBlocks",()=>{for(let t=0;t<this.blocks.length;t++)this.blocks[t].instanceMatrix=new E(new Float32Array(this.maxCount*this.blocksFactor[t]*16),16)});i(this,"generate",()=>{if(this.blocksCount=new Array(this.blocks.length).fill(0),this.generateWorker.postMessage({distance:this.distance,chunk:this.chunk,noiseSeed:this.noise.seed,treeSeed:this.noise.treeSeed,stoneSeed:this.noise.stoneSeed,coalSeed:this.noise.coalSeed,idMap:new Map,blocksFactor:this.blocksFactor,blocksCount:this.blocksCount,customBlocks:this.customBlocks,chunkSize:this.chunkSize}),this.cloudGap++>5){this.cloudGap=0,this.cloud.instanceMatrix=new E(new Float32Array(1e3*16),16),this.cloudCount=0;for(let t=-this.chunkSize*this.distance*3+this.chunkSize*this.chunk.x;t<this.chunkSize*this.distance*3+this.chunkSize+this.chunkSize*this.chunk.x;t+=20)for(let s=-this.chunkSize*this.distance*3+this.chunkSize*this.chunk.y;s<this.chunkSize*this.distance*3+this.chunkSize+this.chunkSize*this.chunk.y;s+=20){const e=new L;e.setPosition(t,80+(Math.random()-.5)*30,s),Math.random()>.8&&this.cloud.setMatrixAt(this.cloudCount++,e)}this.cloud.instanceMatrix.needsUpdate=!0}});i(this,"generateAdjacentBlocks",t=>{const{x:s,y:e,z:a}=t,n=this.noise,l=Math.floor(n.get(s/n.gap,a/n.gap,n.seed)*n.amp);if(e>30+l)return;const h=n.get(s/n.stoneGap,a/n.stoneGap,n.stoneSeed)*n.stoneAmp;let c;h>n.stoneThreshold||e<23?c=5:l<-3?c=1:c=4,this.buildBlock(new y(s,e-1,a),c),this.buildBlock(new y(s,e+1,a),c),this.buildBlock(new y(s-1,e,a),c),this.buildBlock(new y(s+1,e,a),c),this.buildBlock(new y(s,e,a-1),c),this.buildBlock(new y(s,e,a+1),c),this.blocks[c].instanceMatrix.needsUpdate=!0});i(this,"buildBlock",(t,s)=>{const e=this.noise,a=Math.floor(e.get(t.x/e.gap,t.z/e.gap,e.seed)*e.amp);if(t.y>=30+a||t.y<0)return;t.y===0&&(s=11);for(const l of this.customBlocks)if(l.x===t.x&&l.y===t.y&&l.z===t.z)return;this.customBlocks.push(new $(t.x,t.y,t.z,s,!0));const n=new L;n.setPosition(t),this.blocks[s].setMatrixAt(this.getCount(s),n),this.blocks[s].instanceMatrix.needsUpdate=!0,this.setCount(s)});i(this,"update",()=>{this.chunk.set(Math.floor(this.camera.position.x/this.chunkSize),Math.floor(this.camera.position.z/this.chunkSize)),(this.chunk.x!==this.previousChunk.x||this.chunk.y!==this.previousChunk.y)&&this.generate(),this.previousChunk.copy(this.chunk),this.highlight.update()});this.scene=t,this.camera=s,this.maxCount=(this.distance*this.chunkSize*2+this.chunkSize)**2+500,this.highlight=new Jt(t,s,this),this.scene.add(this.cloud),this.generateWorker.onmessage=e=>{this.resetBlocks(),this.idMap=e.data.idMap,this.blocksCount=e.data.blocksCount;for(let a=0;a<e.data.arrays.length;a++)this.blocks[a].instanceMatrix=new E(this.blocks[a].instanceMatrix.array=e.data.arrays[a],16);for(const a of this.blocks)a.instanceMatrix.needsUpdate=!0}}}const te=o=>{const t=document.createElement("template");t.innerHTML=o,window.document.body.appendChild(t.content)},C=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);class ee{constructor(t,s,e,a,n){i(this,"scene");i(this,"camera");i(this,"lastCameraPos",new y(0,0,0));i(this,"player");i(this,"terrain");i(this,"control");i(this,"audio");i(this,"velocity",new y(0,0,0));i(this,"frontCollide",!1);i(this,"backCollide",!1);i(this,"leftCollide",!1);i(this,"rightCollide",!1);i(this,"downCollide",!0);i(this,"upCollide",!1);i(this,"isJumping",!1);i(this,"raycasterDown",new P);i(this,"raycasterUp",new P);i(this,"raycasterFront",new P);i(this,"raycasterBack",new P);i(this,"raycasterRight",new P);i(this,"raycasterLeft",new P);i(this,"tempMesh",new S(new z(1,1,1),new nt,100));i(this,"tempMeshMatrix",new E(new Float32Array(100*16),16));i(this,"p1",performance.now());i(this,"p2",performance.now());i(this,"raycaster");i(this,"far");i(this,"holdingBlock",g.grass);i(this,"holdingBlocks",[g.grass,g.stone,g.tree,g.wood,g.diamond,g.quartz,g.glass,g.grass,g.grass,g.grass]);i(this,"holdingIndex",0);i(this,"wheelGap",!1);i(this,"clickInterval");i(this,"jumpInterval");i(this,"mouseHolding",!1);i(this,"spaceHolding",!1);i(this,"initRayCaster",()=>{this.raycasterUp.ray.direction=new y(0,1,0),this.raycasterDown.ray.direction=new y(0,-1,0),this.raycasterFront.ray.direction=new y(1,0,0),this.raycasterBack.ray.direction=new y(-1,0,0),this.raycasterLeft.ray.direction=new y(0,0,-1),this.raycasterRight.ray.direction=new y(0,0,1),this.raycasterUp.far=1.2,this.raycasterDown.far=this.player.body.height,this.raycasterFront.far=this.player.body.width,this.raycasterBack.far=this.player.body.width,this.raycasterLeft.far=this.player.body.width,this.raycasterRight.far=this.player.body.width});i(this,"downKeys",{a:!1,d:!1,w:!1,s:!1});i(this,"setMovementHandler",t=>{if(!t.repeat)switch(t.key){case"q":this.player.mode===p.walking?this.player.setMode(p.flying):this.player.setMode(p.walking),this.velocity.y=0,this.velocity.x=0,this.velocity.z=0;break;case"w":case"W":this.downKeys.w=!0,this.velocity.x=this.player.speed;break;case"s":case"S":this.downKeys.s=!0,this.velocity.x=-this.player.speed;break;case"a":case"A":this.downKeys.a=!0,this.velocity.z=-this.player.speed;break;case"d":case"D":this.downKeys.d=!0,this.velocity.z=this.player.speed;break;case" ":if(this.player.mode===p.sneaking&&!this.isJumping)return;this.player.mode===p.walking?this.isJumping||(this.velocity.y=8,this.isJumping=!0,this.downCollide=!1,this.far=0,setTimeout(()=>{this.far=this.player.body.height},300)):this.velocity.y+=this.player.speed,this.player.mode===p.walking&&!this.spaceHolding&&(this.spaceHolding=!0,this.jumpInterval=setInterval(()=>{this.setMovementHandler(t)},10));break;case"Shift":this.player.mode===p.walking?this.isJumping||(this.player.setMode(p.sneaking),this.downKeys.w&&(this.velocity.x=this.player.speed),this.downKeys.s&&(this.velocity.x=-this.player.speed),this.downKeys.a&&(this.velocity.z=-this.player.speed),this.downKeys.d&&(this.velocity.z=this.player.speed),this.camera.position.setY(this.camera.position.y-.2)):this.velocity.y-=this.player.speed;break}});i(this,"resetMovementHandler",t=>{if(!t.repeat)switch(t.key){case"w":case"W":this.downKeys.w=!1,this.velocity.x=0;break;case"s":case"S":this.downKeys.s=!1,this.velocity.x=0;break;case"a":case"A":this.downKeys.a=!1,this.velocity.z=0;break;case"d":case"D":this.downKeys.d=!1,this.velocity.z=0;break;case" ":if(this.player.mode===p.sneaking&&!this.isJumping||(this.jumpInterval&&clearInterval(this.jumpInterval),this.spaceHolding=!1,this.player.mode===p.walking))return;this.velocity.y=0;break;case"Shift":if(this.player.mode===p.sneaking&&(this.isJumping||(this.player.setMode(p.walking),this.downKeys.w&&(this.velocity.x=this.player.speed),this.downKeys.s&&(this.velocity.x=-this.player.speed),this.downKeys.a&&(this.velocity.z=-this.player.speed),this.downKeys.d&&(this.velocity.z=this.player.speed),this.camera.position.setY(this.camera.position.y+.2))),this.player.mode===p.walking)return;this.velocity.y=0;break}});i(this,"mousedownHandler",t=>{t.preventDefault(),this.raycaster.setFromCamera({x:0,y:0},this.camera);const s=this.raycaster.intersectObjects(this.terrain.blocks)[0],e=new L;switch(t.button){case 0:if(s&&s.object instanceof S){s.object.getMatrixAt(s.instanceId,e);const a=new y().setFromMatrixPosition(e);if(g[s.object.name]===g.bedrock){this.terrain.generateAdjacentBlocks(a);return}s.object.setMatrixAt(s.instanceId,new L().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),this.audio.playSound(g[s.object.name]);const n=new G(new z(1,1,1),this.terrain.materials.get(this.terrain.materialType[parseInt(g[s.object.name])]));n.position.set(a.x,a.y,a.z),this.scene.add(n);const l=performance.now();let h=0;const c=()=>{if(performance.now()-l>250){this.scene.remove(n),cancelAnimationFrame(h);return}h=requestAnimationFrame(c),n.geometry.scale(.85,.85,.85)};c(),s.object.instanceMatrix.needsUpdate=!0;let f=!1;for(const u of this.terrain.customBlocks)u.x===a.x&&u.y===a.y&&u.z===a.z&&(f=!0,u.placed=!1);f||this.terrain.customBlocks.push(new $(a.x,a.y,a.z,g[s.object.name],!1)),this.terrain.generateAdjacentBlocks(a)}break;case 2:if(s&&s.object instanceof S){const a=s.face.normal;s.object.getMatrixAt(s.instanceId,e);const n=new y().setFromMatrixPosition(e);if(n.x+a.x===Math.round(this.camera.position.x)&&n.z+a.z===Math.round(this.camera.position.z)&&(n.y+a.y===Math.round(this.camera.position.y)||n.y+a.y===Math.round(this.camera.position.y-1)))return;e.setPosition(a.x+n.x,a.y+n.y,a.z+n.z),this.terrain.blocks[this.holdingBlock].setMatrixAt(this.terrain.getCount(this.holdingBlock),e),this.terrain.setCount(this.holdingBlock),this.audio.playSound(this.holdingBlock),this.terrain.blocks[this.holdingBlock].instanceMatrix.needsUpdate=!0;let l=new $(a.x+n.x,a.y+n.y,a.z+n.z,this.holdingBlock,!0);l.type==g.diamond?this.ui.linkDialog().then(h=>{l.attributes=h,console.log(h),this.terrain.customBlocks.push(l)}):this.terrain.customBlocks.push(l)}break}!C&&!this.mouseHolding&&(this.mouseHolding=!0,this.clickInterval=setInterval(()=>{this.mousedownHandler(t)},333))});i(this,"mouseupHandler",()=>{this.clickInterval&&clearInterval(this.clickInterval),this.mouseHolding=!1});i(this,"changeHoldingBlockHandler",t=>{var s;isNaN(parseInt(t.key))||t.key==="0"||(this.holdingIndex=parseInt(t.key)-1,this.holdingBlock=(s=this.holdingBlocks[this.holdingIndex])!=null?s:g.grass)});i(this,"wheelHandler",t=>{var s;this.wheelGap||(this.wheelGap=!0,setTimeout(()=>{this.wheelGap=!1},100),t.deltaY>0?(this.holdingIndex++,this.holdingIndex>9&&(this.holdingIndex=0)):t.deltaY<0&&(this.holdingIndex--,this.holdingIndex<0&&(this.holdingIndex=9)),this.holdingBlock=(s=this.holdingBlocks[this.holdingIndex])!=null?s:g.grass)});i(this,"initEventListeners",()=>{document.addEventListener("pointerlockchange",()=>{document.pointerLockElement?(document.body.addEventListener("keydown",this.changeHoldingBlockHandler),document.body.addEventListener("wheel",this.wheelHandler),document.body.addEventListener("keydown",this.setMovementHandler),document.body.addEventListener("keyup",this.resetMovementHandler),document.body.addEventListener("mousedown",this.mousedownHandler),document.body.addEventListener("mouseup",this.mouseupHandler)):(document.body.removeEventListener("keydown",this.changeHoldingBlockHandler),document.body.removeEventListener("wheel",this.wheelHandler),document.body.removeEventListener("keydown",this.setMovementHandler),document.body.removeEventListener("keyup",this.resetMovementHandler),document.body.removeEventListener("mousedown",this.mousedownHandler),document.body.removeEventListener("mouseup",this.mouseupHandler),this.velocity=new y(0,0,0))})});i(this,"moveZ",(t,s)=>{this.camera.position.z+=t*(this.player.speed/Math.PI)*2*s});i(this,"collideCheckAll",(t,s,e,a)=>{this.collideCheck(4,t,s,e,a),this.collideCheck(0,t,s,e),this.collideCheck(1,t,s,e),this.collideCheck(2,t,s,e),this.collideCheck(3,t,s,e),this.collideCheck(5,t,s,e)});i(this,"collideCheck",(t,s,e,a,n=this.player.body.width)=>{const l=new L;let h=0;this.tempMesh.instanceMatrix=new E(new Float32Array(100*16),16);let c=!1,f=new Array(this.terrain.noise.treeHeight+1).fill(!1),u=Math.round(s.x),v=Math.round(s.z);switch(t){case 0:u++,this.raycasterFront.ray.origin=s;break;case 1:u--,this.raycasterBack.ray.origin=s;break;case 2:v--,this.raycasterLeft.ray.origin=s;break;case 3:v++,this.raycasterRight.ray.origin=s;break;case 4:this.raycasterDown.ray.origin=s,this.raycasterDown.far=n;break;case 5:this.raycasterUp.ray.origin=new y().copy(s),this.raycasterUp.ray.origin.y--;break}let x=Math.floor(e.get(u/e.gap,v/e.gap,e.seed)*e.amp)+30;for(const d of a)if(d.x===u&&d.z===v)if(d.placed)l.setPosition(d.x,d.y,d.z),this.tempMesh.setMatrixAt(h++,l);else if(d.y===x)c=!0;else for(let r=1;r<=this.terrain.noise.treeHeight;r++)d.y===x+r&&(f[r]=!0);c||(l.setPosition(u,x,v),this.tempMesh.setMatrixAt(h++,l));for(let d=1;d<=this.terrain.noise.treeHeight;d++)if(!f[d]){let r=e.get(u/e.treeGap,v/e.treeGap,e.treeSeed)*e.treeAmp,M=e.get(u/e.stoneGap,v/e.stoneGap,e.stoneSeed)*e.stoneAmp;r>e.treeThreshold&&x>=27&&M<e.stoneThreshold&&(l.setPosition(u,x+d,v),this.tempMesh.setMatrixAt(h++,l))}this.player.mode===p.sneaking&&x<Math.floor(this.camera.position.y-2)&&t!==4&&t!==5&&(l.setPosition(u,Math.floor(this.camera.position.y-1),v),this.tempMesh.setMatrixAt(h++,l)),this.tempMesh.instanceMatrix.needsUpdate=!0;const I=new y(s.x,s.y-1,s.z);switch(t){case 0:{const d=this.raycasterFront.intersectObject(this.tempMesh).length;this.raycasterFront.ray.origin=I;const r=this.raycasterFront.intersectObject(this.tempMesh).length;d||r?this.frontCollide=!0:this.frontCollide=!1;break}case 1:{const d=this.raycasterBack.intersectObject(this.tempMesh).length;this.raycasterBack.ray.origin=I;const r=this.raycasterBack.intersectObject(this.tempMesh).length;d||r?this.backCollide=!0:this.backCollide=!1;break}case 2:{const d=this.raycasterLeft.intersectObject(this.tempMesh).length;this.raycasterLeft.ray.origin=I;const r=this.raycasterLeft.intersectObject(this.tempMesh).length;d||r?this.leftCollide=!0:this.leftCollide=!1;break}case 3:{const d=this.raycasterRight.intersectObject(this.tempMesh).length;this.raycasterRight.ray.origin=I;const r=this.raycasterRight.intersectObject(this.tempMesh).length;d||r?this.rightCollide=!0:this.rightCollide=!1;break}case 4:{this.raycasterDown.intersectObject(this.tempMesh).length?this.downCollide=!0:this.downCollide=!1;break}case 5:{this.raycasterUp.intersectObject(this.tempMesh).length?this.upCollide=!0:this.upCollide=!1;break}}});i(this,"update",()=>{this.p1=performance.now();const t=(this.p1-this.p2)/1e3;if(this.player.mode===p.flying)this.control.moveForward(this.velocity.x*t),this.control.moveRight(this.velocity.z*t),this.camera.position.y+=this.velocity.y*t;else{if(this.collideCheckAll(this.camera.position,this.terrain.noise,this.terrain.customBlocks,this.far-this.velocity.y*t),Math.abs(this.velocity.y)<this.player.falling&&(this.velocity.y-=25*t),this.upCollide&&(this.velocity.y=-225*t,this.far=this.player.body.height),this.downCollide&&!this.isJumping){this.velocity.y=0;const a=this.camera.position.clone().add(new y(0,-1*this.player.body.height,0)).round();if(!a.equals(this.lastCameraPos)){this.lastCameraPos=a;const n=this.terrain.customBlocks.filter(l=>l.x===a.x&&l.y===a.y&&l.z===a.z&&l.placed);if(n.length>0){const l=n[0];if(this.player.mode!==p.sneaking&&l.type===g.diamond&&l.attributes.length>0&&l.attributes[0]==="link"){const h=document.createElement("a");h.href=l.attributes[1],h.target=l.attributes[2],h.click()}}}}else this.downCollide&&this.isJumping&&(this.isJumping=!1);let s=new y(0,0,-1).applyQuaternion(this.camera.quaternion),e=Math.atan2(s.x,s.z);this.frontCollide||this.backCollide||this.leftCollide||this.rightCollide?(this.frontCollide&&(e<Math.PI&&e>0&&this.velocity.x>0?(!this.leftCollide&&e>Math.PI/2||!this.rightCollide&&e<Math.PI/2)&&this.moveZ(Math.PI/2-e,t):!this.leftCollide&&!this.rightCollide&&this.velocity.x>0&&this.control.moveForward(this.velocity.x*t),e<0&&e>-Math.PI&&this.velocity.x<0?(!this.leftCollide&&e>-Math.PI/2||!this.rightCollide&&e<-Math.PI/2)&&this.moveZ(-Math.PI/2-e,t):!this.leftCollide&&!this.rightCollide&&this.velocity.x<0&&this.control.moveForward(this.velocity.x*t),e<Math.PI/2&&e>-Math.PI/2&&this.velocity.z<0?(!this.rightCollide&&e<0||!this.leftCollide&&e>0)&&this.moveZ(-e,t):!this.leftCollide&&!this.rightCollide&&this.velocity.z<0&&this.control.moveRight(this.velocity.z*t),(e<-Math.PI/2||e>Math.PI/2)&&this.velocity.z>0?(!this.rightCollide&&e>0&&this.moveZ(Math.PI-e,t),!this.leftCollide&&e<0&&this.moveZ(-Math.PI-e,t)):!this.leftCollide&&!this.rightCollide&&this.velocity.z>0&&this.control.moveRight(this.velocity.z*t)),this.backCollide&&(e<0&&e>-Math.PI&&this.velocity.x>0?(!this.leftCollide&&e<-Math.PI/2||!this.rightCollide&&e>-Math.PI/2)&&this.moveZ(Math.PI/2+e,t):!this.leftCollide&&!this.rightCollide&&this.velocity.x>0&&this.control.moveForward(this.velocity.x*t),e<Math.PI&&e>0&&this.velocity.x<0?(!this.leftCollide&&e<Math.PI/2||!this.rightCollide&&e>Math.PI/2)&&this.moveZ(e-Math.PI/2,t):!this.leftCollide&&!this.rightCollide&&this.velocity.x<0&&this.control.moveForward(this.velocity.x*t),(e<-Math.PI/2||e>Math.PI/2)&&this.velocity.z<0?(!this.leftCollide&&e>0&&this.moveZ(-Math.PI+e,t),!this.rightCollide&&e<0&&this.moveZ(Math.PI+e,t)):!this.leftCollide&&!this.rightCollide&&this.velocity.z<0&&this.control.moveRight(this.velocity.z*t),e<Math.PI/2&&e>-Math.PI/2&&this.velocity.z>0?(!this.leftCollide&&e<0||!this.rightCollide&&e>0)&&this.moveZ(e,t):!this.leftCollide&&!this.rightCollide&&this.velocity.z>0&&this.control.moveRight(this.velocity.z*t)),this.leftCollide&&((e<-Math.PI/2||e>Math.PI/2)&&this.velocity.x>0?(!this.frontCollide&&e>0&&this.moveX(Math.PI-e,t),!this.backCollide&&e<0&&this.moveX(-Math.PI-e,t)):!this.frontCollide&&!this.backCollide&&this.velocity.x>0?this.control.moveForward(this.velocity.x*t):this.frontCollide&&e<0&&e>-Math.PI/2&&this.velocity.x>0?this.control.moveForward(this.velocity.x*t):this.backCollide&&e<Math.PI/2&&e>0&&this.velocity.x>0&&this.control.moveForward(this.velocity.x*t),e<Math.PI/2&&e>-Math.PI/2&&this.velocity.x<0?(!this.frontCollide&&e<0||!this.backCollide&&e>0)&&this.moveX(-e,t):!this.frontCollide&&!this.backCollide&&this.velocity.x<0?this.control.moveForward(this.velocity.x*t):this.frontCollide&&e<Math.PI&&e>Math.PI/2&&this.velocity.x<0?this.control.moveForward(this.velocity.x*t):this.backCollide&&e>-Math.PI&&e<-Math.PI/2&&this.velocity.x<0&&this.control.moveForward(this.velocity.x*t),e>0&&e<Math.PI&&this.velocity.z<0?(!this.backCollide&&e>Math.PI/2||!this.frontCollide&&e<Math.PI/2)&&this.moveX(Math.PI/2-e,t):!this.frontCollide&&!this.backCollide&&this.velocity.z<0?this.control.moveRight(this.velocity.z*t):this.frontCollide&&e>-Math.PI&&e<-Math.PI/2&&this.velocity.z<0?this.control.moveRight(this.velocity.z*t):this.backCollide&&e>-Math.PI/2&&e<0&&this.velocity.z<0&&this.control.moveRight(this.velocity.z*t),e<0&&e>-Math.PI&&this.velocity.z>0?(!this.backCollide&&e>-Math.PI/2||!this.frontCollide&&e<-Math.PI/2)&&this.moveX(-Math.PI/2-e,t):!this.frontCollide&&!this.backCollide&&this.velocity.z>0?this.control.moveRight(this.velocity.z*t):this.frontCollide&&e<Math.PI/2&&e>0&&this.velocity.z>0?this.control.moveRight(this.velocity.z*t):this.backCollide&&e<Math.PI&&e>Math.PI/2&&this.velocity.z>0&&this.control.moveRight(this.velocity.z*t)),this.rightCollide&&(e<Math.PI/2&&e>-Math.PI/2&&this.velocity.x>0?(!this.backCollide&&e<0||!this.frontCollide&&e>0)&&this.moveX(e,t):!this.frontCollide&&!this.backCollide&&this.velocity.x>0?this.control.moveForward(this.velocity.x*t):this.frontCollide&&e<-Math.PI/2&&e>-Math.PI&&this.velocity.x>0?this.control.moveForward(this.velocity.x*t):this.backCollide&&e<Math.PI&&e>Math.PI/2&&this.velocity.x>0&&this.control.moveForward(this.velocity.x*t),(e<-Math.PI/2||e>Math.PI/2)&&this.velocity.x<0?(!this.backCollide&&e>0&&this.moveX(-Math.PI+e,t),!this.frontCollide&&e<0&&this.moveX(Math.PI+e,t)):!this.frontCollide&&!this.backCollide&&this.velocity.x<0?this.control.moveForward(this.velocity.x*t):this.frontCollide&&e<Math.PI/2&&e>0&&this.velocity.x<0?this.control.moveForward(this.velocity.x*t):this.backCollide&&e<0&&e>-Math.PI/2&&this.velocity.x<0&&this.control.moveForward(this.velocity.x*t),e<0&&e>-Math.PI&&this.velocity.z<0?(!this.frontCollide&&e>-Math.PI/2||!this.backCollide&&e<-Math.PI/2)&&this.moveX(Math.PI/2+e,t):!this.frontCollide&&!this.backCollide&&this.velocity.z<0?this.control.moveRight(this.velocity.z*t):this.frontCollide&&e>Math.PI/2&&e<Math.PI&&this.velocity.z<0?this.control.moveRight(this.velocity.z*t):this.backCollide&&e>0&&e<Math.PI/2&&this.velocity.z<0&&this.control.moveRight(this.velocity.z*t),e>0&&e<Math.PI&&this.velocity.z>0?(!this.frontCollide&&e>Math.PI/2||!this.backCollide&&e<Math.PI/2)&&this.moveX(e-Math.PI/2,t):!this.frontCollide&&!this.backCollide&&this.velocity.z>0?this.control.moveRight(this.velocity.z*t):this.frontCollide&&e>-Math.PI/2&&e<0&&this.velocity.z>0?this.control.moveRight(this.velocity.z*t):this.backCollide&&e>-Math.PI&&e<-Math.PI/2&&this.velocity.z>0&&this.control.moveRight(this.velocity.z*t))):(this.control.moveForward(this.velocity.x*t),this.control.moveRight(this.velocity.z*t)),this.camera.position.y+=this.velocity.y*t,this.camera.position.y<-100&&(this.camera.position.y=60)}this.p2=this.p1});this.ui=null,this.scene=t,this.camera=s,this.player=e,this.terrain=a,this.control=new Pt(s,document.body),this.audio=n,this.raycaster=new P,this.raycaster.far=8,this.far=this.player.body.height,this.initRayCaster(),this.initEventListeners()}moveX(t,s){this.camera.position.x+=t*(this.player.speed/Math.PI)*2*s}}class ie{constructor(){i(this,"p1",performance.now());i(this,"p2",performance.now());i(this,"gap",performance.now());i(this,"fps",document.createElement("div"));i(this,"count",0);i(this,"update",()=>{this.p1=performance.now(),this.count++,performance.now()-this.gap>1e3&&(this.fps.innerHTML=`FPS: ${this.count}`,this.gap=performance.now(),this.count=0),this.p2=this.p1});this.fps.className="fps",this.fps.innerHTML="FPS: 60",document.body.appendChild(this.fps)}}var se="/assets/grass.020eb145.png",ae="/assets/stone.53e38748.png",oe="/assets/tree.98a9b0d4.png",ne="/assets/wood.9768871f.png",re="/assets/diamond.b6171099.png",le="/assets/quartz.9ffd1d51.png",he="/assets/glass.3e48b289.png";class ce{constructor(){i(this,"wheelGap",!1);i(this,"current",0);i(this,"icon",[se,ae,oe,ne,re,le,he]);i(this,"iconIndex",0);i(this,"y",0);i(this,"bag",document.createElement("div"));i(this,"items",new Array(10).fill(null).map(()=>{let t=document.createElement("div");t.className="item";let s=document.createElement("img");return this.icon[this.iconIndex]&&(s.className="icon",s.alt="block",s.src=this.icon[this.iconIndex++],t.appendChild(s)),t}));if(!C){this.bag.className="bag",this.items[0].classList.add("selected");for(let t=0;t<this.items.length;t++)this.bag.appendChild(this.items[t]);document.body.appendChild(this.bag),document.body.addEventListener("keydown",t=>{if(!(isNaN(parseInt(t.key))||t.key==="0")){for(let s=0;s<this.items.length;s++)this.items[s].classList.remove("selected");this.current=parseInt(t.key)-1,this.items[this.current].classList.add("selected")}}),document.body.addEventListener("wheel",t=>{if(!this.wheelGap){this.wheelGap=!0,setTimeout(()=>{this.wheelGap=!1},100),t.deltaY>0?(this.current++,this.current>9&&(this.current=0)):t.deltaY<0&&(this.current--,this.current<0&&(this.current=9));for(let s=0;s<this.items.length;s++)this.items[s].classList.remove("selected");this.items[this.current].classList.add("selected")}})}}}var de=`<div class="joystick">
  <button id="action-front" class="joystick-button front" role="div">\u{1F53C}</button>
  <button id="action-left" class="joystick-button left" role="div">\u25C0\uFE0F</button>
  <button id="action-right" class="joystick-button right" role="div">\u25B6\uFE0F</button>
  <button id="action-back" class="joystick-button back" role="div">\u{1F53D}</button>
  <button id="action-mode" class="joystick-button mode" role="div">\u23F9\uFE0F</button>
  <button id="action-up" class="joystick-button up" role="div">\u{1F53C}</button>
  <button id="action-down" class="joystick-button down hidden" role="div">
    \u{1F53D}
  </button>
</div>

<style>
  .joystick {
    position: fixed;
    bottom: 0;
    display: grid;
    width: 100%;
    grid-template-columns: repeat(auto-fill, 50px);
    grid-template-rows: repeat(3, 1fr);
    gap: 10px;
    padding: 10px;
  }
  .joystick-button {
    width: 52px;
    height: 50px;
    font-size: 50px;
    line-height: 50px;
    padding: 0px;
    border: none;
    background-color: transparent;
  }
  .front {
    grid-column: 2 / 3;
    grid-row: 1;
  }
  .left {
    grid-column: 1 / 2;
    grid-row: 2;
  }
  .right {
    grid-column: 3 / 4;
    grid-row: 2;
  }
  .back {
    grid-column: 2 / 3;
    grid-row: 3;
  }
  .mode {
    grid-column: 2 / 3;
    grid-row: 2;
  }
  .up {
    grid-column: -3 / -2;
    grid-row: 2;
  }
  .down {
    grid-column: -3 / -2;
    grid-row: 3;
  }
</style>
`;class ue{constructor(t){i(this,"control");i(this,"pageX",0);i(this,"pageY",0);i(this,"clickX",0);i(this,"clickY",0);i(this,"euler");i(this,"clickTimeout");i(this,"clickInterval");i(this,"hold",!1);i(this,"emitKeyboardEvent",t=>({key:t}));i(this,"emitClickEvent",t=>({button:t,preventDefault:()=>{}}));i(this,"initButton",({actionKey:t,key:s})=>{const e=document.querySelector(`#action-${t}`);e.addEventListener("pointermove",a=>{a.stopPropagation()}),e.addEventListener("pointerdown",a=>{this.control.setMovementHandler(this.emitKeyboardEvent(s)),a.stopPropagation()}),e.addEventListener("pointerup",a=>{this.control.resetMovementHandler(this.emitKeyboardEvent(s)),a.stopPropagation()}),t==="mode"&&s==="q"&&(this.initButton({actionKey:"mode",key:" "}),e.addEventListener("pointerdown",()=>{var a,n;this.control.player.mode===p.flying?(a=document.querySelector("#action-down"))==null||a.classList.remove("hidden"):(n=document.querySelector("#action-down"))==null||n.classList.add("hidden")}))});i(this,"init",()=>{te(de),this.initButton({actionKey:"front",key:"w"}),this.initButton({actionKey:"left",key:"a"}),this.initButton({actionKey:"right",key:"d"}),this.initButton({actionKey:"back",key:"s"}),this.initButton({actionKey:"mode",key:"q"}),this.initButton({actionKey:"up",key:" "}),this.initButton({actionKey:"down",key:"Shift"}),document.addEventListener("pointermove",t=>{(this.pageX!==0||this.pageY!==0)&&(this.euler.setFromQuaternion(this.control.camera.quaternion),this.euler.y-=.01*(t.pageX-this.pageX),this.euler.x-=.01*(t.pageY-this.pageY),this.euler.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.euler.x)),this.control.camera.quaternion.setFromEuler(this.euler)),this.pageX=t.pageX,this.pageY=t.pageY,this.clickTimeout&&clearTimeout(this.clickTimeout)}),document.addEventListener("pointerdown",t=>{this.clickX=t.pageX,this.clickY=t.pageY,this.clickTimeout=setTimeout(()=>{t.pageX===this.clickX&&t.pageY===this.clickY&&(this.control.mousedownHandler(this.emitClickEvent(0)),this.clickInterval=setInterval(()=>{this.control.mousedownHandler(this.emitClickEvent(0))},333),this.hold=!0)},500)}),document.addEventListener("pointerup",t=>{this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickInterval&&clearInterval(this.clickInterval),!this.hold&&t.pageX===this.clickX&&t.pageY===this.clickY&&this.control.mousedownHandler(this.emitClickEvent(2)),this.hold=!1,this.pageX=0,this.pageY=0})});this.control=t,this.euler=new Lt(0,0,0,"YXZ")}}class me{constructor(t,s){i(this,"fps");i(this,"bag");i(this,"joystick");i(this,"menu",document.querySelector(".menu"));i(this,"crossHair",document.createElement("div"));i(this,"play",document.querySelector("#play"));i(this,"control",document.querySelector("#control"));i(this,"setting",document.querySelector("#setting"));i(this,"feature",document.querySelector("#feature"));i(this,"back",document.querySelector("#back"));i(this,"exit",document.querySelector("#exit"));i(this,"save",document.querySelector("#save"));i(this,"saveModal",document.querySelector(".save-modal"));i(this,"loadModal",document.querySelector(".load-modal"));i(this,"settings",document.querySelector(".settings"));i(this,"features",document.querySelector(".features"));i(this,"github",document.querySelector(".github"));i(this,"distance",document.querySelector("#distance"));i(this,"distanceInput",document.querySelector("#distance-input"));i(this,"fov",document.querySelector("#fov"));i(this,"fovInput",document.querySelector("#fov-input"));i(this,"music",document.querySelector("#music"));i(this,"musicInput",document.querySelector("#music-input"));i(this,"settingBack",document.querySelector("#setting-back"));i(this,"linkDialog",()=>{const t=document.querySelector(".create-link"),s=document.getElementById("link-type"),e=document.getElementById("link"),a=document.getElementById("target"),n=document.getElementById("anchor"),l=t.querySelector(".create-link__link"),h=t.querySelector(".create-link__anchor");return s.addEventListener("change",c=>{s.value==="anchor"?(l.classList.add("hidden"),h.classList.remove("hidden")):(l.classList.remove("hidden"),h.classList.add("hidden"))}),new Promise(c=>{t==null||t.classList.remove("hidden"),e==null||e.setAttribute("value",""),a==null||a.setAttribute("value",""),n==null||n.setAttribute("value",""),e==null||e.focus(),t==null||t.addEventListener("submit",f=>{f.preventDefault();const u=[s==null?void 0:s.value];s.value==="link"?(u.push(e==null?void 0:e.value),u.push(a==null?void 0:a.value)):s.value==="anchor"&&u.push(n==null?void 0:n.value),t==null||t.classList.add("hidden"),c(u)},{once:!0})})});i(this,"loadSave",t=>{var a;this.terrain.noise.seed=Number(t.seed)||Math.random();const s=t.block||[];this.terrain.customBlocks=s,this.terrain.initBlocks(),this.terrain.generate();const e=(a=t.position)!=null?a:null;if(document.location.hash!==""){const n=s.filter(l=>l.attributes.length>1&&l.attributes[0]==="anchor"&&l.attributes[1]===document.location.hash.replace("#",""));n.length>0&&(e.x=n[0].x,e.y=n[0].y+2,e.z=n[0].z)}e&&(this.terrain.camera.position.x=e.x),e&&(this.terrain.camera.position.y=e.y),e&&(this.terrain.camera.position.z=e.z),this.onPlay(),this.onLoad(),!C&&this.control.control.lock()});i(this,"tryLoadIndexSave",async()=>{const t=await fetch("/index.wwwCraft.json");if(t.ok){const s=await t.json();this.loadSave(s)}});i(this,"onPlay",()=>{var t,s,e;C&&this.joystick.init(),(t=this.menu)==null||t.classList.add("hidden"),(s=this.menu)==null||s.classList.remove("start"),this.play&&(this.play.innerHTML="Resume"),this.crossHair.classList.remove("hidden"),this.github&&this.github.classList.add("hidden"),(e=this.feature)==null||e.classList.add("hidden")});i(this,"onPause",()=>{var t;(t=this.menu)==null||t.classList.remove("hidden"),this.crossHair.classList.add("hidden"),this.save&&(this.save.innerHTML="Save and Exit"),this.github&&this.github.classList.remove("hidden")});i(this,"onExit",()=>{var t,s;(t=this.menu)==null||t.classList.add("start"),this.play&&(this.play.innerHTML="Play"),this.save&&(this.save.innerHTML="Load Game"),(s=this.feature)==null||s.classList.remove("hidden")});i(this,"onSave",()=>{var t;(t=this.saveModal)==null||t.classList.remove("hidden"),setTimeout(()=>{var s;(s=this.saveModal)==null||s.classList.add("show")}),setTimeout(()=>{var s;(s=this.saveModal)==null||s.classList.remove("show")},1e3),setTimeout(()=>{var s;(s=this.saveModal)==null||s.classList.add("hidden")},1350)});i(this,"onLoad",()=>{var t;(t=this.loadModal)==null||t.classList.remove("hidden"),setTimeout(()=>{var s;(s=this.loadModal)==null||s.classList.add("show")}),setTimeout(()=>{var s;(s=this.loadModal)==null||s.classList.remove("show")},1e3),setTimeout(()=>{var s;(s=this.loadModal)==null||s.classList.add("hidden")},1350)});i(this,"update",()=>{this.fps.update()});var e,a,n,l,h,c,f,u,v,x,I,d;this.fps=new ie,this.bag=new ce,this.joystick=new ue(s),this.terrain=t,this.control=s,this.crossHair.className="cross-hair",this.crossHair.innerHTML="+",document.body.appendChild(this.crossHair),(e=this.play)==null||e.addEventListener("click",()=>{var r;((r=this.play)==null?void 0:r.innerHTML)==="Play"&&(this.onPlay(),t.noise.seed=Math.random(),t.noise.stoneSeed=Math.random(),t.noise.treeSeed=Math.random(),t.noise.coalSeed=Math.random(),t.noise.leafSeed=Math.random(),t.customBlocks=[],t.initBlocks(),t.generate(),t.camera.position.y=40,s.player.setMode(p.walking)),!C&&s.control.lock()}),(a=this.save)==null||a.addEventListener("click",()=>{var r;if(((r=this.save)==null?void 0:r.innerHTML)==="Save and Exit"){const M={block:t.customBlocks,seed:t.noise.seed,position:{x:t.camera.position.x,y:t.camera.position.y,z:t.camera.position.z}},W=JSON.stringify(M);localStorage.setItem("wwwCraftGameData",W);const pt=new Blob([W],{type:"application/json"}),vt=URL.createObjectURL(pt),_=document.createElement("a");_.href=vt,_.download="index.wwwCraft.json",_.click(),this.onExit(),this.onSave()}else{const M=JSON.parse(localStorage.getItem("wwwCraftGameData")||"{}");this.loadSave(M)}}),(n=this.feature)==null||n.addEventListener("click",()=>{var r;(r=this.features)==null||r.classList.remove("hidden")}),(l=this.back)==null||l.addEventListener("click",()=>{var r;(r=this.features)==null||r.classList.add("hidden")}),(h=this.setting)==null||h.addEventListener("click",()=>{var r;(r=this.settings)==null||r.classList.remove("hidden")}),(c=this.settingBack)==null||c.addEventListener("click",()=>{var r;(r=this.settings)==null||r.classList.add("hidden")}),(f=this.distanceInput)==null||f.addEventListener("input",r=>{this.distance&&r.target instanceof HTMLInputElement&&(this.distance.innerHTML=`Render Distance: ${r.target.value}`)}),(u=this.fovInput)==null||u.addEventListener("input",r=>{this.fov&&r.target instanceof HTMLInputElement&&(this.fov.innerHTML=`Field of View: ${r.target.value}`,s.camera.fov=parseInt(r.target.value),s.camera.updateProjectionMatrix())}),(v=this.musicInput)==null||v.addEventListener("input",r=>{if(this.fov&&r.target instanceof HTMLInputElement){const M=r.target.value==="0";s.audio.disabled=M,this.music.innerHTML=`Music: ${M?"Off":"On"}`}}),(x=this.settingBack)==null||x.addEventListener("click",()=>{this.distanceInput instanceof HTMLInputElement&&(t.distance=parseInt(this.distanceInput.value),t.maxCount=(t.distance*t.chunkSize*2+t.chunkSize)**2+500,t.initBlocks(),t.generate(),t.scene.fog=new at(8900331,1,t.distance*24+24))}),document.body.addEventListener("keydown",r=>{r.key==="e"&&document.pointerLockElement&&!C&&s.control.unlock(),r.key==="f"&&(document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen())}),(I=this.exit)==null||I.addEventListener("click",()=>{this.onExit()}),document.addEventListener("pointerlockchange",()=>{document.pointerLockElement?this.onPlay():this.onPause()}),document.addEventListener("contextmenu",r=>{r.preventDefault()}),(d=document.querySelector("canvas"))==null||d.addEventListener("click",r=>{r.preventDefault(),!C&&s.control.lock()}),window.addEventListener("hashchange",()=>{if(document.location.hash==="")return;const r=t.customBlocks.filter(M=>M.attributes.length>1&&M.attributes[0]==="anchor"&&M.attributes[1]===document.location.hash.replace("#",""));r.length>0&&(this.terrain.camera.position.x=r[0].x,this.terrain.camera.position.y=r[0].y+2,this.terrain.camera.position.z=r[0].z)})}}var fe="/assets/hal3.2642662e.ogg",ge="/assets/grass1.3619fdb8.ogg",ye="/assets/grass2.b0763cf2.ogg",pe="/assets/grass3.9ac02803.ogg",ve="/assets/grass4.dd733357.ogg",ke="/assets/sand1.1260ef32.ogg",we="/assets/sand2.74ef2fa1.ogg",be="/assets/sand3.0441e996.ogg",Me="/assets/sand4.42ac9116.ogg",F="/assets/stone1.97f2a8a7.ogg",H="/assets/stone2.98a5c319.ogg",j="/assets/stone3.19273f0e.ogg",A="/assets/stone4.b164e732.ogg",xe="/assets/dirt1.55a610c8.ogg",Ce="/assets/dirt2.60ebf0ed.ogg",Ie="/assets/dirt3.ab5e4b40.ogg",Pe="/assets/dirt4.fd4aa755.ogg",tt="/assets/tree1.cb6071c8.ogg",et="/assets/tree2.59edca84.ogg",it="/assets/tree3.cf6be231.ogg",st="/assets/tree4.de868b31.ogg",Le="/assets/leaf1.74400cfe.ogg",ze="/assets/leaf2.b7636085.ogg",Se="/assets/leaf3.6228533c.ogg",Ee="/assets/leaf4.72db3634.ogg";class Fe{constructor(t){i(this,"disabled",!1);i(this,"sourceSet",[[ge,ye,pe,ve],[ke,we,be,Me],[tt,et,it,st],[Le,ze,Se,Ee],[xe,Ce,Ie,Pe],[F,H,j,A],[F,H,j,A],[tt,et,it,st],[F,H,j,A],[F,H,j,A],[F,H,j,A]]);i(this,"soundSet",[]);i(this,"index",0);if(C)return;const s=new zt,e=new St;t.add(s);const a=new Q(s);a.autoplay=!1,e.load(fe,n=>{a.setBuffer(n),a.setVolume(.1),a.setLoop(!0),a.isPlaying&&(a.pause(),a.play())}),document.addEventListener("pointerlockchange",()=>{document.pointerLockElement&&!a.isPlaying&&!this.disabled?a.play():a.pause()});for(const n of this.sourceSet){const l=[];for(const h of n)e.load(h,c=>{const f=new Q(s);f.setBuffer(c),f.setVolume(.15),l.push(f)});this.soundSet.push(l)}}playSound(t){var s,e;!this.disabled&&!C&&(this.index++===3&&(this.index=0),(e=(s=this.soundSet[t])==null?void 0:s[this.index])==null||e.play())}}const D=new Ft,R=D.camera,T=D.scene,He=D.renderer,je=new Ht,Ae=new Fe(R),Y=new Qt(T,R),N=new ee(T,R,je,Y,Ae),U=new me(Y,N);N.ui=U;(function o(){requestAnimationFrame(o),N.update(),Y.update(),U.update(),He.render(T,R)})();U.tryLoadIndexSave();
//# sourceMappingURL=index.c9e839a4.js.map
